<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />
    <title>Sign up or sign in</title>
    <meta name="next-head-count" content="3" />    
    <!-- Not sure that we want bootstrap here or not -->
    <!-- <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
    /> -->

    <link
      rel="stylesheet"
      href="https://cdn.statically.io/gh/NathanTrost/azure-b2c-template/gh-pages/resources/default.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.statically.io/gh/NathanTrost/azure-b2c-template/gh-pages/resources/custom.css"
    />

  

    <script>
      var localBuildUrl = 'http://localhost:5000/'; // Use serve package
      var ghPagesUrl = "https://nathantrost.github.io/azure-b2c-template/"; // Local gh page
      var isLiveAzure = 
        !(window.location.href === localBuildUrl || 
        window.location.href === ghPagesUrl); 
          
       function buildToggleButton(pwd) {
        var id = `${pwd.id}-visibilityToggler`;

        var button = document.createElement("button");        
        button.textContent = "Show";
        button.setAttribute("type", "button");
        button.setAttribute("id", id);  
        button.setAttribute('class', "showPasswordButton")

        pwd.insertAdjacentElement("afterend", button);

        function toggleVisibility() {
          pwd.type = pwd.type === 'password' ? 'text' : 'password'
        }

        button.onclick = toggleVisibility;
        // For non-mouse usage
        button.onkeydown = toggleVisibility;
      }

      function createPwdToggleButtons() {
        var pwdInputs = document.querySelectorAll("input[type=password]");
        for (var i = 0; i < pwdInputs.length; i++) {
          buildToggleButton(pwdInputs[i]);
        }
      }
 
      function wrap(el, wrapper) {
        el.parentNode.insertBefore(wrapper, el);
        wrapper.appendChild(el);
      }

      function copyOriginalAzureNodes() {
        // Wrap email label as azure does with password
        var azureEmailLabel = document.querySelector("label[for=email]");
        var emailLabelWrapper = document.createElement('div')
        emailLabelWrapper.setAttribute('class', 'email-label form-label');
        wrap(azureEmailLabel, emailLabelWrapper);

        var azureEmailForm = document.getElementById('email');
        azureEmailForm.setAttribute('autocomplete', 'email');

        var azurePasswordLabelWrapper = document.querySelector(".password-label");
        passwordLabelWrapper.setAttribute('class', 'password-label form-label');


        // Copy "create account" node and move it below "Sign in" text
        var azureCreate = document.querySelector('.create');
        var newCreate = azureCreate.cloneNode(true);
        var azureIntro = document.querySelector('.intro');
        azureIntro.insertAdjacentElement("afterend", newCreate);

        // Copy "forgot password" link and move directly under our created password-input-wrapper
        var azureForgotPassword = document.getElementById('forgotPassword');
        var newForgotPassword = azureForgotPassword.cloneNode(true);
        newForgotPassword.setAttribute('id', 'amuForgotPassword');  

        var azurePasswordInput = document.getElementById('password');
        azurePasswordInput.insertAdjacentElement("afterend", newForgotPassword);
  

        // Dom manipulation will break azure form, but we can hide these
        var azureDivider = document.querySelector('.divider');
        azureDivider.setAttribute('class', 'hide');
        azureForgotPassword.setAttribute('class', 'hide');
        azureCreate.setAttribute('class', 'hide');
      };



      // Show mock api form if in local or gh-pages environments
      function showInDev(){
        var apiDevForm = document.getElementById('api-dev');
        if (isLiveAzure) {
          apiDevForm.remove()
        } else {
          apiDevForm.setAttribute("id", 'api');
        };
      }


      setTimeout(() => {
        showInDev();
        copyOriginalAzureNodes();
        createPwdToggleButtons();
        // Make smooth CSS transition for api form elements
        var azureForm =  document.getElementById('api');
        azureForm.style.display = 'block';
      }, 500);

    </script>
  </head>
  <body>
    <div class="home_container">
      <div class="container unified_container" role="presentation">
        <div class="row">
          <div class="col-lg-6">
            <div class="panel panel-default">
              <div class="panel-body">
                <h3 className="signin-header">Sign in to your account</h1>
                
                 <div id="api-dev" style="display: none;">
                  <form id="localAccountForm" action="JavaScript:void(0);" class="localAccount" aria-label="Sign in with your email address">
                    <div class="intro">
                      <h2 aria-level="1">
                        Sign in with your email address
                      </h2>
                    </div>
                    <div class="error pageLevel" aria-hidden="true" role="alert" style="display: none;">
                      <p></p>
                    </div>
                    <div class="entry">
                      <div class="entry-item">
                        <label for="email">
                          Email Address
                        </label>
                        <div class="error itemLevel" aria-hidden="true" role="alert" style="display: none;">
                          <p></p>
                        </div>
                        <input autocomplete="email" type="email" id="email" name="Email Address" title="Please enter a valid Email Address" pattern="^[a-zA-Z0-9!#$%&amp;'+^_`{}~-]+(?:\.[a-zA-Z0-9!#$%&amp;'+^_`{}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$" autofocus="" placeholder="Email Address" aria-label="Email Address">
                      </div>
                        <div class="entry-item">
                          <div class="password-label">
                            <label for="password">Password</label>
                                <a id="forgotPassword" href="/amub2c.onmicrosoft.com/B2C_1_test2/api/CombinedSigninAndSignup/unified?claimsexchange=ForgotPassword&amp;csrf_token=QWhIZzdsellNNEsrelJ6TlcwS3dZMC9lT1ZnWFFMbFVwNVpEdUZFZGdwYmZHRkwzNXRnRkpWQlpBQ24vMml4UnFtRDUxUk9LdXZiK0lDeS9vZkRmWnc9PTsyMDIxLTA0LTIxVDE5OjQzOjUyLjAyNDQzWjt2OHpSWjJWbTVLeFZPRVQzVEJnYXJRPT07eyJPcmNoZXN0cmF0aW9uU3RlcCI6MX0=&amp;tx=StateProperties=eyJUSUQiOiJkMTMzOGRhNC03NmY0LTQ5ZGQtOGM3YS04ZGUwOWJhODA3YTkifQ&amp;p=B2C_1_test2">Forgot your password?</a>
                                          </div>
                          <div class="error itemLevel" aria-hidden="true" style="display: none;">
                            <p role="alert"></p>
                          </div>
                          <input autocomplete="current-password"  type="password" id="password" name="Password" placeholder="Password" aria-label="Password" autocomplete="current-password" aria-required="true">
                          
                                      </div>
                      <div class="working"></div>
            
            
                      <div class="buttons">
                        <button id="next" type="submit" form="localAccountForm">Sign in</button>
                      </div>
                    </div>
                          <div class="divider">
                            <h2>OR</h2>
                          </div>
                          <div class="create">
                            <p>
                              Don't have an account?<a id="createAccount" href="/amub2c.onmicrosoft.com/B2C_1_test2/api/CombinedSigninAndSignup/unified?local=signup&amp;csrf_token=QWhIZzdsellNNEsrelJ6TlcwS3dZMC9lT1ZnWFFMbFVwNVpEdUZFZGdwYmZHRkwzNXRnRkpWQlpBQ24vMml4UnFtRDUxUk9LdXZiK0lDeS9vZkRmWnc9PTsyMDIxLTA0LTIxVDE5OjQzOjUyLjAyNDQzWjt2OHpSWjJWbTVLeFZPRVQzVEJnYXJRPT07eyJPcmNoZXN0cmF0aW9uU3RlcCI6MX0=&amp;tx=StateProperties=eyJUSUQiOiJkMTMzOGRhNC03NmY0LTQ5ZGQtOGM3YS04ZGUwOWJhODA3YTkifQ&amp;p=B2C_1_test2">Sign up now</a>
                            </p>
                          </div>
                  </form>
             
                
                
                </div>
              
                <div id="api" style="display: none;"></div>
              </div>
              
             
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
